{{ define "plans_content" }}
{{ $sortField := .SortPlans.SortField }}
{{ $sortOrder := .SortPlans.SortOrder }}
{{ $startDate := .SortPlans.StartDate }}
{{ $endDate := .SortPlans.EndDate }}

<div class="d-flex justify-content-between align-items-center mt-2">
    <h1 class="h2 mb-3">{{ .Title }}</h1>
    <button class="btn btn-primary btn-lg" id="addProductionBtn"
            onclick="window.open('/aforms/plans/add', '_self')">
        <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å —Å–º–µ–Ω–Ω–æ-—Å—É—Ç–æ—á–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ
    </button>
</div>

<!--–í –î–ê–õ–¨–ù–ï–ô–®–ï–ú –ë–£–î–ï–¢ –ü–û–ò–°–ö-->
<!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–∞–º -->
<div class="card mb-1">
    <div class="card-body">
        <form method="GET" action="/aforms/plans" id="dateFilterForm" class="row g-3 align-items-end">
            <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ -->
            <input type="hidden" name="sort" value="{{ $sortField }}">
            <input type="hidden" name="order" value="{{ $sortOrder }}">

            <div class="col-md-1">
                <label for="startDate" class="form-label">–î–∞—Ç–∞ —Å:</label>
                <input type="date"
                       class="form-control"
                       id="startDate"
                       name="startDate"
                       value="{{ if $startDate }}{{ $startDate }}{{ end }}">
            </div>

            <div class="col-md-1">
                <label for="endDate" class="form-label">–î–∞—Ç–∞ –ø–æ:</label>
                <input type="date"
                       class="form-control"
                       id="endDate"
                       name="endDate"
                       value="{{ if $endDate }}{{ $endDate }}{{ end }}">
            </div>

            <div class="col-md-1">
                <button type="submit" class="btn btn-primary w-70">
                    <i class="bi bi-funnel"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                </button>
            </div>
        </form>

        <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ -->
        {{ if or $startDate $endDate }}
        <div class="mt-2">
            <small class="text-muted">
                <i class="bi bi-filter"></i> –ê–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä:
                {{ if $startDate }}—Å {{ $startDate }}{{ end }}
                {{ if $endDate }}–ø–æ {{ $endDate }}{{ end }}
                <a href="/aforms/plans?sort={{ $sortField }}&order={{ $sortOrder }}"
                   class="text-danger ms-2 text-decoration-none">
                    <i class="bi bi-x"></i> –°–±—Ä–æ—Å–∏—Ç—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 180 –¥–Ω–µ–π)
                </a>
            </small>
        </div>
        {{ end }}
    </div>
</div>

<!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å —Ç–∞–±–ª–∏—Ü–µ–π - –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º -->
<div class="card shadow-sm">
    <div class="card-body p-0">

        <div class="table-responsive" style="min-width: 1200px;">

            <!-- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞ -->
            <div style="height: calc(100vh - 400px); overflow-y: auto; position:relative;">
                <table class="table table-hover mb-0" style="min-width: 1200px;" id="productionsTable">

                    <colgroup>
                        <col style="width: 70px"> <!-- –ê–†–¢–ò–ö–£–õ-->
                        <col style="width: 500px"> <!-- –ü–†–û–î–£–ö–¶–ò–Ø-->
                        <col style="width: 60px"> <!-- –ö–û–î –ü–õ–ê–ù–ê-->
                        <col style="width: 60px"> <!-- –°–ú–ï–ù–ê-->
                        <col style="width: 90px"> <!-- –ö–û–î –ü–†–û–î–£–ö–¶–ò–ò-->
                        <col style="width: 240px"> <!-- –£–ß–ê–°–¢–û–ö-->
                        <col style="width: 60px"> <!-- –ö–û–î –£–ß–ê–°–¢–ö–ê-->
                        <col style="width: 80px"> <!-- –ü–õ–ê–ù–û–í–û–ï –ö–û–õ-–í–û-->
                        <col style="width: 100px"> <!-- –î–ê–¢–ê –ü–õ–ê–ù–ê-->
                        <col style="width: 110px"> <!-- –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò-->
                        <col style="width: 150px"> <!-- –î–ê–¢–ê –ò –í–†–ï–ú–Ø –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ó–ê–ü–ò–°–ò-->
                        <col style="width: 140px"> <!-- –¢–ò–ü –ü–†–û–î–£–ö–¶–ò–ò-->
                        <col style="width: 110px"> <!-- –¶–í–ï–¢-->
                        <col style="width: 110px"> <!-- –ö–û–õ-–í–û –í –†–Ø–î–£-->
                        <col style="width: 110px"> <!-- –ö–û–õ-–í–û –†–Ø–î–û–í-->
                        <col style="width: 110px"> <!-- –í–ï–° –£–ü–ê–ö–û–í–ö–ò-->
                        <col style="width: 110px"> <!-- –ì–ê–ë–ê–†–ò–¢–´ –£–ü–ê–ö–û–í–ö–ò-->
                        <col style="width: 110px">
                    </colgroup>

                    <thead class="table-light"
                           style="position: sticky; top: 0; z-index: 10; background-color: #f8f9fa;">
                    <tr>

                        <th class="text-nowrap sortable-header text-center" style="position: relative; padding-bottom: 13px;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PrArticle` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –ê—Ä—Ç–∏–∫—É–ª
                                {{ if eq $sortField "PrArticle" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header " style="position: relative; padding-bottom: 13px;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PrName` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏—è
                                {{ if eq $sortField "PrName" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header text-center" style="position: relative;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `IdPlan` }}"
                               class="text-decoration-none text-dark d-flex align-items-center justify-content-center w-100 h-100">
                                <div class="d-flex flex-column align-items-center me-1">
                                    <span>–ö–æ–¥</span>
                                    <span>–ø–ª–∞–Ω–∞</span>
                                </div>
                                {{ if eq $sortField "IdPlan" }}
                                <span class="sort-indicator ms-1">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header" style="position: relative; padding-bottom: 13px;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PlanShift` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –°–º–µ–Ω–∞
                                {{ if eq $sortField "PlanShift" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header" style="position: relative;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `ExtProduction` }}"
                               class="text-decoration-none text-dark d-flex align-items-center justify-content-center w-100 h-100">
                                <div class="d-flex flex-column align-items-center me-2">
                                    <span>–ö–æ–¥</span>
                                    <span>–ø—Ä–æ–¥—É–∫—Ü–∏–∏</span>
                                </div>
                                {{ if eq $sortField "ExtProduction" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header text-center" style="position: relative; padding-bottom: 13px;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `SectorName` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –£—á–∞—Å—Ç–æ–∫
                                {{ if eq $sortField "SectorName" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header text-center" style="position: relative;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `ExtSector` }}"
                               class="text-decoration-none text-dark d-flex align-items-center justify-content-center w-100 h-100">
                                <div class="d-flex flex-column align-items-center me-1">
                                    <span>–ö–æ–¥</span>
                                    <span>—É—á–∞—Å—Ç–∫–∞</span>
                                </div>
                                {{ if eq $sortField "ExtSector" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header text-center" style="position: relative;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PlanCount` }}"
                               class="text-decoration-none text-dark d-flex align-items-center justify-content-center w-100 h-100">
                                <div class="d-flex flex-column align-items-center me-2">
                                    <span>–ü–ª–∞–Ω–æ–≤–æ–µ</span>
                                    <span>–∫–æ–ª-–≤–æ</span>
                                </div>
                                {{ if eq $sortField "PlanCount" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header text-center" style="position: relative; padding-bottom: 13px;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PlanDate` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –î–∞—Ç–∞ –ø–ª–∞–Ω–∞
                                {{ if eq $sortField "PlanDate" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header text-center" style="position: relative; padding-bottom: 13px;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PlanInfo` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –ó–∞–º–µ—Ç–∫–∏
                                {{ if eq $sortField "PlanInfo" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header text-center" style="position: relative;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PlEditDate` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è <br> –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
                                {{ if eq $sortField "PlEditDate" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header text-center" style="position: relative; padding-bottom: 13px;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PrType` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –¢–∏–ø –ø—Ä–æ–¥—É–∫—Ü–∏–∏
                                {{ if eq $sortField "PrType" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>


                        <th class="text-nowrap sortable-header text-center" style="position: relative; padding-bottom: 13px;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PrColor` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –¶–≤–µ—Ç
                                {{ if eq $sortField "PrColor" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header text-center" style="position: relative;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PrCount` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –ö–æ–ª-–≤–æ <br> –≤ —Ä—è–¥—É
                                {{ if eq $sortField "PrCount" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header text-center" style="position: relative;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PrRows` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –ö–æ–ª-–≤–æ <br> —Ä—è–¥–æ–≤
                                {{ if eq $sortField "PrRows" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header text-center" style="position: relative;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PrWeight` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –í–µ—Å —É–ø–∞–∫–æ–≤–∫–∏ <br> (–∫–≥)
                                {{ if eq $sortField "PrWeight" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap sortable-header text-center" style="position: relative; padding-bottom: 13px;">
                            <a href="{{ buildSortURL $sortField $sortOrder $startDate $endDate `PrHWD` }}"
                               class="text-decoration-none text-dark d-block w-100 h-100">
                                –ì–∞–±–∞—Ä–∏—Ç—ã —É–ø–∞–∫–æ–≤–∫–∏
                                {{ if eq $sortField "PrHWD" }}
                                <span class="sort-indicator">
                                    {{ if eq $sortOrder "ASC" }}‚Üë{{ else }}‚Üì{{ end }}
                                </span>
                                {{ end }}
                            </a>
                        </th>

                        <th class="text-nowrap text-center" style="padding-bottom: 13px;">–û–ø–µ—Ä–∞—Ü–∏–∏</th>

                    </tr>
                    </thead>
                    <tbody>

                    {{ range .Plans }}
                    <tr>
                        <td class="text-center">{{ .ProductionModel.PrArticle }}</td>
                        <td>{{ .ProductionModel.PrName }}</td>
                        <td class="text-center">{{ .IdPlan }}</td>
                        <td class="text-center">{{ .PlanShift }}</td>
                        <td class="text-center">{{ .ExtProduction }}</td>
                        <td>{{ .SectorModel.SectorName }}</td>
                        <td class="text-center">{{ .ExtSector }}</td>
                        <td class="text-center">{{ .PlanCount }}</td>
                        <td class="text-center">{{ formatDate .PlanDate }}</td>
                        <td>{{ .PlanInfo }}</td>
                        <td class="text-center">{{ formatDateTime .PlEditDate }}</td>
                        <td class="text-center">{{ .ProductionModel.PrType }}</td>
                        <td class="text-center">{{ .ProductionModel.PrColor }}</td>
                        <td class="text-center">{{ .ProductionModel.PrCount }}</td>
                        <td class="text-center">{{ .ProductionModel.PrRows }}</td>
                        <td class="text-center">{{ .ProductionModel.PrWeight }}</td>
                        <td class="text-center">{{ .ProductionModel.PrHWD }}</td>

                        <!-- –ö–Ω–æ–ø–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–π -->
                        <td>
                            <div class="d-flex justify-content-center gap-1">
                                <!-- –ö–Ω–æ–ø–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                                <button class="btn btn-sm btn-outline-primary edit-btn px-1 py-1"
                                        title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                                        onclick="window.open('/aforms/plans/upd?idPlan={{ .IdPlan }}', '_self')">
                                    <span>‚úèÔ∏è</span>
                                </button>
                                <button class="btn btn-sm btn-outline-success copy-btn px-2 py-1"
                                        title="–°–æ–∑–¥–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–æ–π –∑–∞–ø–∏—Å–∏"
                                        onclick="window.open('/aforms/plans/add?basedOn={{ .IdPlan }}', '_self')">
                                    <span>üìã</span>
                                </button>
                            </div>
                        </td>

                    </tr>
                    {{ end }}

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="alert {{ if eq (len .Plans) 0 }}alert-warning{{ else }}alert-info{{ end }} mt-2 py-1 px-3">
    <i class="bi bi-{{ if eq (len .Plans) 0 }}exclamation-triangle{{ else }}info-circle{{ end }}"></i>
    –í—Å–µ–≥–æ: {{ len .Plans }}
    <!--    –í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ: {{ len .Productions }} –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —É–ø–∞–∫–æ–≤–∫–∏-->
</div>


<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç
    function setDateRange(days) {
        const endDate = new Date();
        const startDate = new Date();
        startDate.setDate(endDate.getDate() - days);

        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD
        document.getElementById('startDate').value = formatDate(startDate);
        document.getElementById('endDate').value = formatDate(endDate);
    }

    // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã
    function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∞—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ, –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã
    document.addEventListener('DOMContentLoaded', function() {
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');

        if (!startDateInput.value && !endDateInput.value) {
            setDateRange(180);
        }
    });
</script>

{{ end }}